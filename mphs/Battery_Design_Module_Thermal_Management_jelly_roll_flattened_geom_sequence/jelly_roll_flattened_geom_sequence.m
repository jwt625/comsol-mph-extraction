function out = model
%
% jelly_roll_flattened_geom_sequence.m
%
% Model exported on May 26 2025, 21:26 by COMSOL 6.2.0.339.

import com.comsol.model.*
import com.comsol.model.util.*

model = ModelUtil.create('Model');

model.modelPath('/Applications/COMSOL62/Multiphysics/applications/Battery_Design_Module/Thermal_Management');

model.modelNode.create('comp1', true);

model.geom.create('geom1', 3);
model.geom('geom1').model('comp1');

model.mesh.create('mesh1', 'geom1');

% To import content from file, use:
% model.param.loadFile('FILENAME');
model.param.set('r_mandrel', '2[mm]', 'Mandrel radius');
model.param.set('r_can', '8.5[mm]', 'Can inner radius');
model.param.set('D_sep', '30[um]', 'Separator thickness');
model.param.set('D_pos', '200[um]', 'Positive electrode thickness');
model.param.set('D_neg', '200[um]', 'Negative electrode thickness');
model.param.set('D_cc_pos', '10[um]', 'Positive current collector foil thickness');
model.param.set('D_cc_neg', '10[um]', 'Negative current collector foil thickness');
model.param.set('D_cell', '2*(D_neg+D_sep+D_pos)+D_cc_pos+D_cc_neg', 'Unit cell thickness');
model.param.set('D_tab_neg', '100[um]', 'Positive tab thickness');
model.param.set('D_tab_pos', '100[um]', 'Negative tab thickness');
model.param.set('theta_start_pos', '2*pi*r_mandrel/D_cell', 'Positive current collector foil start angle');
model.param.set('theta_end_pos', '2*pi*(r_can-(D_cc_pos+D_pos+D_sep+D_neg+D_cc_neg)-D_tab_pos-D_tab_neg)/D_cell', 'Positive current collector foil end angle');
model.param.set('L_cc_pos', 's_spiral(D_cell, theta_end_pos)-s_spiral(D_cell, theta_start_pos)', 'Length of positive current collector foil');
model.param.set('L_unmatched_pos', 's_spiral(D_cell, theta_start_pos+2*pi)-s_spiral(D_cell, theta_start_pos)', 'Unmatched (single sided) positive electrode length');
model.param.set('theta_start_neg', '2*pi*(r_mandrel+D_tab_pos+D_neg+D_sep+D_pos+D_cc_pos)/D_cell', 'Negative current collector foil start angle');
model.param.set('theta_end_neg', '2*pi*(r_can-D_cc_neg-D_tab_neg)/D_cell', 'Negative current collector foil end angle');
model.param.set('L_cc_neg', 's_spiral(D_cell, theta_end_neg)-s_spiral(D_cell, theta_start_neg)', 'Length of negative current collector foil');
model.param.set('L_unmatched_neg', 's_spiral(D_cell, theta_end_neg)-s_spiral(D_cell, theta_end_neg-2*pi)', 'Unmatched (single sided) negative electrode length');
model.param.set('D_offset', 'max(D_neg,D_pos)', 'Virtual offset between layers in geometry');
model.param.set('L_tab', '4[mm]', 'Tab length (width)');
model.param.set('H_jr', '60[mm]', 'Height of jelly roll');
model.param.set('H_tab_in_jr', '2/3*H_jr', 'Height of tab in jelly roll');
model.param.set('H_tab_outside_jr', '5[mm]', 'Height of tab outside jelly roll');

model.func.create('an1', 'Analytic');
model.func('an1').label('Analytic - Archimedal Spiral Length');
model.func('an1').set('funcname', 's_spiral');
model.func('an1').set('expr', 'a/(2*pi)/2*(theta*sqrt(1+theta^2)+log(theta+sqrt(1+theta^2)))');
model.func('an1').set('args', 'a, theta');
model.func('an1').set('fununit', 'm');
model.func('an1').setIndex('argunit', 'm', 0);
model.func('an1').setIndex('argunit', 1, 1);

model.geom('geom1').create('wp1', 'WorkPlane');
model.geom('geom1').feature('wp1').set('unite', true);
model.geom('geom1').feature('wp1').geom.create('r1', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r1').set('size', {'L_cc_pos' 'D_cc_pos'});
model.geom('geom1').feature('wp1').geom.run('r1');
model.geom('geom1').feature('wp1').geom.create('r2', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r2').set('size', {'L_cc_pos-L_unmatched_pos' '1'});
model.geom('geom1').feature('wp1').geom.feature('r2').setIndex('size', 'D_pos', 1);
model.geom('geom1').feature('wp1').geom.feature('r2').set('pos', {'L_unmatched_pos' '0'});
model.geom('geom1').feature('wp1').geom.feature('r2').setIndex('pos', '-D_pos', 1);
model.geom('geom1').feature('wp1').geom.run('r2');

model.view('view2').axis.set('viewscaletype', 'manual');
model.view('view2').axis.set('yscale', 25);

model.geom('geom1').feature('wp1').geom.create('r3', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r3').set('size', {'L_cc_pos-L_unmatched_pos' '1'});
model.geom('geom1').feature('wp1').geom.feature('r3').setIndex('size', 'D_sep/2', 1);
model.geom('geom1').feature('wp1').geom.feature('r3').set('pos', {'L_unmatched_pos' '0'});
model.geom('geom1').feature('wp1').geom.feature('r3').setIndex('pos', '-D_pos-D_sep/2', 1);
model.geom('geom1').feature('wp1').geom.run('r3');
model.geom('geom1').feature('wp1').geom.create('r4', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r4').set('size', {'L_cc_pos' 'D_pos'});
model.geom('geom1').feature('wp1').geom.feature('r4').set('pos', {'0' 'D_cc_pos'});
model.geom('geom1').feature('wp1').geom.run('r4');
model.geom('geom1').feature('wp1').geom.create('r5', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r5').set('size', {'L_cc_pos' 'D_sep/2'});
model.geom('geom1').feature('wp1').geom.feature('r5').set('pos', {'0' 'D_cc_pos+D_pos'});
model.geom('geom1').feature('wp1').geom.run('r5');
model.geom('geom1').feature('wp1').geom.create('r6', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r6').set('size', {'L_cc_neg' 'D_sep/2'});
model.geom('geom1').feature('wp1').geom.feature('r6').set('pos', {'0' 'D_cc_pos+D_pos+D_offset + D_sep/2'});
model.geom('geom1').feature('wp1').geom.run('r6');
model.geom('geom1').feature('wp1').geom.create('r7', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r7').set('size', {'L_cc_neg' 'D_neg'});
model.geom('geom1').feature('wp1').geom.feature('r7').set('pos', {'0' 'D_cc_pos+D_pos+D_offset + D_sep'});
model.geom('geom1').feature('wp1').geom.run('r7');
model.geom('geom1').feature('wp1').geom.create('r8', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r8').set('size', {'L_cc_neg' 'D_cc_neg'});
model.geom('geom1').feature('wp1').geom.feature('r8').set('pos', {'0' 'D_cc_pos+D_pos+D_offset +D_sep+D_neg'});
model.geom('geom1').feature('wp1').geom.run('r8');
model.geom('geom1').feature('wp1').geom.create('r9', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r9').set('size', {'L_cc_neg-L_unmatched_neg' '1'});
model.geom('geom1').feature('wp1').geom.feature('r9').setIndex('size', 'D_neg', 1);
model.geom('geom1').feature('wp1').geom.feature('r9').set('pos', {'0' 'D_cc_pos+D_pos+D_offset +D_sep+D_neg+D_cc_neg'});
model.geom('geom1').feature('wp1').geom.run('r9');
model.geom('geom1').feature('wp1').geom.create('r10', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r10').set('size', {'L_cc_neg-L_unmatched_neg' '1'});
model.geom('geom1').feature('wp1').geom.feature('r10').setIndex('size', 'D_sep/2', 1);
model.geom('geom1').feature('wp1').geom.feature('r10').set('pos', {'0' 'D_cc_pos+D_pos+D_offset +D_sep+2*D_neg+D_cc_neg'});
model.geom('geom1').feature('wp1').geom.run('r10');
model.geom('geom1').run('wp1');
model.geom('geom1').feature.create('ext1', 'Extrude');
model.geom('geom1').feature('ext1').label('Negative CC and Electrodes');
model.geom('geom1').feature('ext1').set('extrudefrom', 'faces');
model.geom('geom1').feature('ext1').set('inputhandling', 'keep');
model.geom('geom1').feature('ext1').selection('inputface').set('wp1', [5 6 7]);
model.geom('geom1').feature('ext1').setIndex('distance', 'H_jr', 0);
model.geom('geom1').feature('ext1').set('selresult', true);
model.geom('geom1').run('ext1');
model.geom('geom1').run('ext1');
model.geom('geom1').feature.duplicate('ext2', 'ext1');
model.geom('geom1').feature('ext2').label('Positive CC and Electrodes');
model.geom('geom1').feature('ext2').selection('inputface').clear('wp1');
model.geom('geom1').feature('ext2').selection('inputface').set('wp1', [1 2 10]);
model.geom('geom1').run('ext2');
model.geom('geom1').feature.duplicate('ext3', 'ext2');
model.geom('geom1').feature('ext3').label('Separators');
model.geom('geom1').feature('ext3').selection('inputface').clear('wp1');
model.geom('geom1').feature('ext3').selection('inputface').set('wp1', [8 9 3 4]);
model.geom('geom1').run('ext3');
model.geom('geom1').create('del1', 'Delete');
model.geom('geom1').feature('del1').selection('input').init;
model.geom('geom1').feature('del1').selection('input').set({'wp1'});
model.geom('geom1').run('del1');
model.geom('geom1').create('wp2', 'WorkPlane');
model.geom('geom1').feature('wp2').set('unite', true);
model.geom('geom1').feature('wp2').set('quickz', 'H_jr+H_tab_outside_jr');
model.geom('geom1').feature('wp2').geom.create('r1', 'Rectangle');
model.geom('geom1').feature('wp2').geom.feature('r1').set('size', {'L_tab' 'D_tab_pos'});
model.geom('geom1').feature('wp2').geom.feature('r1').set('pos', {'0' '-D_tab_pos'});
model.geom('geom1').feature('wp2').geom.run('r1');
model.geom('geom1').run('wp2');
model.geom('geom1').feature.create('ext4', 'Extrude');
model.geom('geom1').feature('ext4').label('Positive Tab');
model.geom('geom1').feature('ext4').setIndex('distance', 'H_tab_outside_jr+H_tab_in_jr', 0);
model.geom('geom1').feature('ext4').set('reverse', true);
model.geom('geom1').feature('ext4').set('selresult', true);
model.geom('geom1').run('ext4');
model.geom('geom1').create('wp3', 'WorkPlane');
model.geom('geom1').feature('wp3').set('unite', true);
model.geom('geom1').feature('wp3').set('quickz', '-H_tab_outside_jr');
model.geom('geom1').feature('wp3').geom.create('r1', 'Rectangle');
model.geom('geom1').feature('wp3').geom.feature('r1').set('size', {'L_tab' 'D_tab_neg'});
model.geom('geom1').feature('wp3').geom.feature('r1').set('pos', {'L_cc_neg-L_tab' '0'});
model.geom('geom1').feature('wp3').geom.feature('r1').setIndex('pos', 'D_cc_pos+D_pos+D_offset +D_sep+D_neg+D_cc_neg', 1);
model.geom('geom1').feature('wp3').geom.run('r1');
model.geom('geom1').run('wp3');
model.geom('geom1').feature.create('ext5', 'Extrude');
model.geom('geom1').feature('ext5').label('Negative Tab');
model.geom('geom1').feature('ext5').setIndex('distance', 'H_tab_outside_jr+H_tab_in_jr', 0);
model.geom('geom1').feature('ext5').set('selresult', true);
model.geom('geom1').run('ext5');
model.geom('geom1').create('unisel1', 'UnionSelection');
model.geom('geom1').feature('unisel1').set('entitydim', -1);
model.geom('geom1').feature('unisel1').set('input', {'ext1' 'ext5'});
model.geom('geom1').feature('unisel1').set('selshow', false);
model.geom('geom1').run('unisel1');
model.geom('geom1').create('uni1', 'Union');
model.geom('geom1').feature('uni1').selection('input').named('unisel1');
model.geom('geom1').run('uni1');
model.geom('geom1').create('unisel2', 'UnionSelection');
model.geom('geom1').feature('unisel2').set('entitydim', -1);
model.geom('geom1').feature('unisel2').set('input', {'ext2' 'ext4'});
model.geom('geom1').feature('unisel2').set('selshow', false);
model.geom('geom1').run('unisel2');
model.geom('geom1').create('uni2', 'Union');
model.geom('geom1').feature('uni2').selection('input').named('unisel2');
model.geom('geom1').run('uni2');
model.geom('geom1').feature('fin').set('action', 'assembly');
model.geom('geom1').run('fin');
model.geom('geom1').create('sel1', 'ExplicitSelection');
model.geom('geom1').feature('sel1').label('Negative CC');
model.geom('geom1').feature('sel1').selection('selection').set('fin', 10);
model.geom('geom1').run('sel1');
model.geom('geom1').create('sel2', 'ExplicitSelection');
model.geom('geom1').feature('sel2').label('Positive CC');
model.geom('geom1').feature('sel2').selection('selection').set('fin', 2);
model.geom('geom1').run('sel2');
model.geom('geom1').create('difsel1', 'DifferenceSelection');
model.geom('geom1').feature('difsel1').label('Negative Electrodes');
model.geom('geom1').feature('difsel1').set('add', {'ext1'});
model.geom('geom1').feature('difsel1').set('subtract', {'sel1'});
model.geom('geom1').run('difsel1');
model.geom('geom1').create('difsel2', 'DifferenceSelection');
model.geom('geom1').feature('difsel2').label('Positive Electrodes');
model.geom('geom1').feature('difsel2').set('add', {'ext2'});
model.geom('geom1').feature('difsel2').set('subtract', {'sel2'});
model.geom('geom1').run('difsel2');
model.geom('geom1').create('unisel3', 'UnionSelection');
model.geom('geom1').feature('unisel3').label('Negative CC and Tab');
model.geom('geom1').feature('unisel3').set('input', {'ext5' 'sel1'});
model.geom('geom1').run('unisel3');
model.geom('geom1').create('unisel4', 'UnionSelection');
model.geom('geom1').feature('unisel4').label('Positive CC and Tab');
model.geom('geom1').feature('unisel4').set('input', {'ext4' 'sel2'});
model.geom('geom1').run('unisel4');
model.geom('geom1').create('unisel5', 'UnionSelection');
model.geom('geom1').feature('unisel5').label('CCs and Tabs');
model.geom('geom1').feature('unisel5').set('input', {'ext4' 'ext5' 'sel1' 'sel2'});
model.geom('geom1').run('unisel5');
model.geom('geom1').create('unisel6', 'UnionSelection');
model.geom('geom1').feature('unisel6').label('Electrodes');
model.geom('geom1').feature('unisel6').set('input', {'difsel1' 'difsel2'});
model.geom('geom1').run('unisel6');
model.geom('geom1').create('sel3', 'ExplicitSelection');
model.geom('geom1').feature('sel3').label('Negative Current Terminal');
model.geom('geom1').feature('sel3').selection('selection').init(2);
model.geom('geom1').feature('sel3').selection('selection').set('fin', 66);
model.geom('geom1').feature.duplicate('sel4', 'sel3');
model.geom('geom1').runPre('sel4');
model.geom('geom1').feature('sel4').selection('selection').clear('fin');
model.geom('geom1').feature('sel4').label('Positive Current Terminal');
model.geom('geom1').feature('sel4').selection('selection').set('fin', 4);
model.geom('geom1').run('sel4');
model.geom('geom1').create('sel5', 'ExplicitSelection');
model.geom('geom1').feature('sel5').label('Quad Mesh Boundaries');
model.geom('geom1').feature('sel5').selection('selection').init(2);
model.geom('geom1').feature('sel5').selection('selection').set('fin', [6 8 9 21 58 63 65 67]);
model.geom('geom1').run('sel5');
model.geom('geom1').create('sel6', 'ExplicitSelection');
model.geom('geom1').feature('sel6').label('Cooling Boundary');
model.geom('geom1').feature('sel6').selection('selection').init(2);
model.geom('geom1').feature('sel6').selection('selection').set('fin', [63 69]);
model.geom('geom1').feature('sel6').label('Cooling Boundaries');
model.geom('geom1').run('sel6');
model.geom('geom1').create('sel7', 'ExplicitSelection');
model.geom('geom1').feature('sel7').label('Destination Boundary 1');
model.geom('geom1').feature('sel7').selection('selection').init(2);
model.geom('geom1').feature('sel7').selection('selection').set('fin', 31);
model.geom('geom1').feature.duplicate('sel8', 'sel7');
model.geom('geom1').feature('sel8').label('Destination Boundary 2');
model.geom('geom1').runPre('sel8');
model.geom('geom1').feature('sel8').selection('selection').clear('fin');
model.geom('geom1').feature('sel8').selection('selection').set('fin', 41);
model.geom('geom1').run('sel8');
model.geom('geom1').feature.duplicate('sel9', 'sel8');
model.geom('geom1').feature('sel9').label('Source Boundary 1');
model.geom('geom1').feature('sel9').selection('selection').clear('fin');
model.geom('geom1').feature('sel9').selection('selection').set('fin', 29);
model.geom('geom1').feature.duplicate('sel10', 'sel9');
model.geom('geom1').feature('sel10').label('Source Boundary 2');
model.geom('geom1').runPre('sel10');
model.geom('geom1').feature('sel10').selection('selection').clear('fin');
model.geom('geom1').feature('sel10').selection('selection').set('fin', 39);
model.geom('geom1').run('sel10');
model.geom('geom1').create('unisel7', 'UnionSelection');
model.geom('geom1').feature('unisel7').label('Extrusion and Coupling Boundaries');
model.geom('geom1').feature('unisel7').set('entitydim', 2);
model.geom('geom1').feature('unisel7').set('input', {'sel7' 'sel8' 'sel9' 'sel10'});
model.geom('geom1').run('unisel7');
model.geom('geom1').create('boxsel1', 'BoxSelection');
model.geom('geom1').feature('boxsel1').set('entitydim', 1);
model.geom('geom1').feature('boxsel1').set('zmin', '-0.01*H_jr');
model.geom('geom1').feature('boxsel1').set('zmax', '0.01*H_jr');
model.geom('geom1').feature('boxsel1').set('condition', 'inside');
model.geom('geom1').feature('boxsel1').set('selshow', false);
model.geom('geom1').run('boxsel1');
model.geom('geom1').feature.duplicate('boxsel2', 'boxsel1');
model.geom('geom1').feature('boxsel2').set('zmin', '0.99*H_jr');
model.geom('geom1').feature('boxsel2').set('zmax', '1.01*H_jr');
model.geom('geom1').run('boxsel2');
model.geom('geom1').create('unisel8', 'UnionSelection');
model.geom('geom1').feature('unisel8').set('entitydim', 1);
model.geom('geom1').feature('unisel8').label('Mapped Mesh Distribution Edges 1');
model.geom('geom1').feature('unisel8').set('input', {'boxsel1' 'boxsel2'});
model.geom('geom1').run('unisel8');
model.geom('geom1').create('adjsel1', 'AdjacentSelection');
model.geom('geom1').feature('adjsel1').set('entitydim', 2);
model.geom('geom1').feature('adjsel1').set('input', {'unisel7'});
model.geom('geom1').feature('adjsel1').set('outputdim', 1);
model.geom('geom1').feature('adjsel1').set('selshow', false);
model.geom('geom1').run('adjsel1');
model.geom('geom1').create('difsel3', 'DifferenceSelection');
model.geom('geom1').feature('difsel3').label('Mapped Mesh Distribution Edges 2');
model.geom('geom1').feature('difsel3').set('entitydim', 1);
model.geom('geom1').feature('difsel3').set('add', {'adjsel1'});
model.geom('geom1').feature('difsel3').set('subtract', {'unisel8'});
model.geom('geom1').run('difsel3');
model.geom('geom1').create('sel11', 'ExplicitSelection');
model.geom('geom1').feature('sel11').selection('selection').init(1);
model.geom('geom1').feature('sel11').label('Mesh Size Edges');
model.geom('geom1').feature('sel11').selection('selection').set('fin', [13 123]);

model.title([]);

model.description('');

model.label('jelly_roll_flattened_geom_sequence.mph');

model.modelNode.label('Components');

out = model;
