function out = model
%
% pemfc_serpentine_flow_field_geom_sequence.m
%
% Model exported on May 26 2025, 21:28 by COMSOL 6.2.0.339.

import com.comsol.model.*
import com.comsol.model.util.*

model = ModelUtil.create('Model');

model.modelPath('/Applications/COMSOL62/Multiphysics/applications/Fuel_Cell_and_Electrolyzer_Module/Fuel_Cells');

model.modelNode.create('comp1', true);

model.geom.create('geom1', 3);
model.geom('geom1').model('comp1');

model.mesh.create('mesh1', 'geom1');

% To import content from file, use:
% model.param.loadFile('FILENAME');
model.param.set('W_plate_min', '20[mm]', 'Minimum plate width');
model.param.set('N_ch', '4', 'Number of channels');
model.param.set('N_repeat', '3', 'Number of repeating units');
model.param.set('W_rib', '0.7[mm]', 'Rib width');
model.param.set('W_ch', '0.8[mm]', 'Channel width');
model.param.set('H_ch', 'W_ch', 'Channel height');
model.param.set('H_gdl', '0.2[mm]', 'Gdl height');
model.param.set('H_mem', '30[um]', 'Membrane thickness');
model.param.set('FLOW_DIRECTION', '1', 'Use 1 for counter flow, 0 for coflow');
model.param.set('W_plate', 'max(W_plate_min,N_ch*W_ribch*2)', 'Plate width');
model.param.set('W_ribch', 'W_rib+W_ch', 'Channel-to-channel distance');
model.param.set('L_repeat', 'N_ch*2*W_ribch', 'Length of repeating unit');
model.param.set('L_plate', 'L_repeat*N_repeat', 'Plate length');

model.geom('geom1').create('wp1', 'WorkPlane');
model.geom('geom1').feature('wp1').set('unite', true);
model.geom('geom1').feature('wp1').set('quickz', 'H_gdl+H_mem/2');
model.geom('geom1').feature('wp1').geom.create('r1', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r1').set('size', {'W_plate' 'W_ch'});
model.geom('geom1').feature('wp1').geom.feature('r1').set('pos', {'-W_plate-W_ribch' '0'});
model.geom('geom1').feature('wp1').geom.feature('r1').setIndex('pos', 'W_rib/2', 1);
model.geom('geom1').feature('wp1').geom.run('r1');
model.geom('geom1').feature('wp1').geom.create('c1', 'Circle');
model.geom('geom1').feature('wp1').geom.feature('c1').set('r', 'W_rib/2');
model.geom('geom1').feature('wp1').geom.feature('c1').set('angle', 90);
model.geom('geom1').feature('wp1').geom.feature('c1').set('pos', {'-W_ribch' 'W_ribch'});
model.geom('geom1').feature('wp1').geom.feature('c1').set('rot', 270);
model.geom('geom1').feature('wp1').geom.run('c1');
model.geom('geom1').feature('wp1').geom.feature.duplicate('c2', 'c1');
model.geom('geom1').feature('wp1').geom.feature('c2').set('r', 'W_rib/2+W_ch');
model.geom('geom1').feature('wp1').geom.run('c2');
model.geom('geom1').feature('wp1').geom.create('dif1', 'Difference');
model.geom('geom1').feature('wp1').geom.feature('dif1').selection('input').set({'c2'});
model.geom('geom1').feature('wp1').geom.feature('dif1').selection('input2').set({'c1'});
model.geom('geom1').feature('wp1').geom.run('dif1');
model.geom('geom1').feature('wp1').geom.create('r2', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r2').set('size', {'W_ch' 'W_plate'});
model.geom('geom1').feature('wp1').geom.feature('r2').set('pos', {'-W_rib/2-W_ch' '0'});
model.geom('geom1').feature('wp1').geom.feature('r2').setIndex('pos', 'W_ribch', 1);
model.geom('geom1').feature('wp1').geom.run('r2');
model.geom('geom1').feature('wp1').geom.create('arr1', 'Array');
model.geom('geom1').feature('wp1').geom.feature('arr1').selection('input').set({'dif1' 'r1' 'r2'});
model.geom('geom1').feature('wp1').geom.feature('arr1').set('type', 'linear');
model.geom('geom1').feature('wp1').geom.feature('arr1').set('linearsize', 'N_ch');
model.geom('geom1').feature('wp1').geom.feature('arr1').set('displ', {'-W_ribch' 'W_ribch'});
model.geom('geom1').feature('wp1').geom.run('arr1');
model.geom('geom1').feature('wp1').geom.create('uni1', 'Union');
model.geom('geom1').feature('wp1').geom.feature('uni1').selection('input').set({'arr1'});
model.geom('geom1').feature('wp1').geom.run('uni1');
model.geom('geom1').feature('wp1').geom.create('r3', 'Rectangle');
model.geom('geom1').feature('wp1').geom.feature('r3').set('size', {'W_ribch*N_ch' '1'});
model.geom('geom1').feature('wp1').geom.feature('r3').setIndex('size', 'W_plate/2', 1);
model.geom('geom1').feature('wp1').geom.feature('r3').set('pos', {'-W_ribch*N_ch' '0'});
model.geom('geom1').feature('wp1').geom.run('r3');
model.geom('geom1').feature('wp1').geom.create('int1', 'Intersection');
model.geom('geom1').feature('wp1').geom.feature('int1').selection('input').set({'r3' 'uni1'});
model.geom('geom1').feature('wp1').geom.run('int1');
model.geom('geom1').feature('wp1').geom.create('mir1', 'Mirror');
model.geom('geom1').feature('wp1').geom.feature('mir1').selection('input').set({'int1'});
model.geom('geom1').feature('wp1').geom.feature('mir1').set('keep', true);
model.geom('geom1').feature('wp1').geom.feature('mir1').set('pos', {'0' 'W_plate/2'});
model.geom('geom1').feature('wp1').geom.feature('mir1').set('axis', [0 1]);
model.geom('geom1').feature('wp1').geom.run('mir1');
model.geom('geom1').feature('wp1').geom.create('mir2', 'Mirror');
model.geom('geom1').feature('wp1').geom.feature('mir2').selection('input').set({'mir1'});
model.geom('geom1').feature('wp1').geom.feature('mir2').set('pos', {'-W_ribch*N_ch/2' '0'});
model.geom('geom1').feature('wp1').geom.run('mir2');
model.geom('geom1').feature('wp1').geom.create('uni2', 'Union');
model.geom('geom1').feature('wp1').geom.feature('uni2').selection('input').set({'int1' 'mir2'});
model.geom('geom1').feature('wp1').geom.run('uni2');
model.geom('geom1').feature('wp1').geom.create('mir3', 'Mirror');
model.geom('geom1').feature('wp1').geom.feature('mir3').selection('input').set({'uni2'});
model.geom('geom1').feature('wp1').geom.feature('mir3').set('keep', true);
model.geom('geom1').feature('wp1').geom.run('mir3');
model.geom('geom1').feature('wp1').geom.create('uni3', 'Union');
model.geom('geom1').feature('wp1').geom.feature('uni3').selection('input').set({'mir3' 'uni2'});
model.geom('geom1').feature('wp1').geom.run('uni3');
model.geom('geom1').feature('wp1').geom.create('arr2', 'Array');
model.geom('geom1').feature('wp1').geom.feature('arr2').selection('input').set({'uni3'});
model.geom('geom1').feature('wp1').geom.feature('arr2').set('fullsize', {'N_repeat' '1'});
model.geom('geom1').feature('wp1').geom.feature('arr2').set('displ', {'L_repeat' '0'});
model.geom('geom1').feature('wp1').geom.run('arr2');
model.geom('geom1').feature('wp1').geom.create('uni4', 'Union');
model.geom('geom1').feature('wp1').geom.feature('uni4').selection('input').set({'arr2'});
model.geom('geom1').run('wp1');
model.geom('geom1').feature.create('ext1', 'Extrude');
model.geom('geom1').feature('ext1').label('Channels');
model.geom('geom1').feature('ext1').setIndex('distance', 'H_ch', 0);
model.geom('geom1').feature('ext1').set('selresult', true);
model.geom('geom1').feature('ext1').set('selresultshow', 'all');
model.geom('geom1').run('ext1');
model.geom('geom1').create('wp2', 'WorkPlane');
model.geom('geom1').feature('wp2').set('unite', true);
model.geom('geom1').feature('wp2').set('quickplane', 'zx');
model.geom('geom1').feature('wp2').set('quicky', 'N_ch*W_ribch+W_ch');
model.geom('geom1').run('wp2');
model.geom('geom1').create('pard1', 'PartitionDomains');
model.geom('geom1').feature('pard1').selection('domain').named('ext1');
model.geom('geom1').run('pard1');
model.geom('geom1').create('wp3', 'WorkPlane');
model.geom('geom1').feature('wp3').set('unite', true);
model.geom('geom1').feature('wp3').set('quickplane', 'zx');
model.geom('geom1').feature('wp3').set('quicky', 'W_plate-N_ch*W_ribch-W_ch');
model.geom('geom1').run('wp3');
model.geom('geom1').create('pard2', 'PartitionDomains');
model.geom('geom1').feature('pard2').selection('domain').named('ext1');
model.geom('geom1').run('pard2');
model.geom('geom1').create('blk1', 'Block');
model.geom('geom1').feature('blk1').label('GDL');
model.geom('geom1').feature('blk1').set('size', {'L_plate' 'W_plate' '1'});
model.geom('geom1').feature('blk1').setIndex('size', 'H_gdl', 2);
model.geom('geom1').feature('blk1').set('pos', {'-L_repeat/2' '0' '0'});
model.geom('geom1').feature('blk1').setIndex('pos', 'H_mem/2', 2);
model.geom('geom1').feature('blk1').set('selresult', true);
model.geom('geom1').run('blk1');
model.geom('geom1').feature.create('ext2', 'Extrude');
model.geom('geom1').feature('ext2').label('Membrane');
model.geom('geom1').feature('ext2').set('extrudefrom', 'faces');
model.geom('geom1').feature('ext2').selection('inputface').set('blk1', 1);
model.geom('geom1').feature('ext2').set('inputhandling', 'keep');
model.geom('geom1').feature('ext2').setIndex('distance', 'H_mem/2', 0);
model.geom('geom1').feature('ext2').set('selresult', true);
model.geom('geom1').feature('ext2').set('selresultshow', 'all');
model.geom('geom1').run('ext2');
model.geom('geom1').create('uni1', 'Union');
model.geom('geom1').feature('uni1').selection('input').set({'blk1' 'ext2' 'pard2'});
model.geom('geom1').run('uni1');
model.geom('geom1').create('boxsel1', 'BoxSelection');
model.geom('geom1').feature('boxsel1').label('GDL Partition Faces');
model.geom('geom1').feature('boxsel1').set('entitydim', 2);
model.geom('geom1').feature('boxsel1').set('zmin', 'H_gdl/2+H_mem/2');
model.geom('geom1').feature('boxsel1').set('zmax', 'H_gdl*3/2+H_mem/2');
model.geom('geom1').feature('boxsel1').set('condition', 'inside');
model.geom('geom1').feature('boxsel1').set('selshow', false);
model.geom('geom1').run('boxsel1');
model.geom('geom1').create('parf1', 'PartitionFaces');
model.geom('geom1').feature('parf1').selection('face').named('boxsel1');
model.geom('geom1').feature('parf1').set('partitionwith', 'workplane');
model.geom('geom1').feature('parf1').set('workplane', 'wp2');
model.geom('geom1').feature.duplicate('parf2', 'parf1');
model.geom('geom1').feature('parf2').set('workplane', 'wp3');
model.geom('geom1').run('parf2');
model.geom('geom1').create('rot1', 'Rotate');
model.geom('geom1').feature('rot1').selection('input').set({'parf2'});
model.geom('geom1').feature('rot1').set('keep', true);
model.geom('geom1').feature('rot1').set('axistype', 'x');
model.geom('geom1').feature('rot1').set('rot', 180);
model.geom('geom1').feature('rot1').set('pos', {'0' 'W_plate/2' '0'});
model.geom('geom1').run('rot1');
model.geom('geom1').feature('fin').set('action', 'assembly');
model.geom('geom1').run('fin');
model.geom('geom1').create('boxsel2', 'BoxSelection');
model.geom('geom1').feature('boxsel2').label('H2 Side Domains');
model.geom('geom1').feature('boxsel2').set('zmax', '-H_mem/4');
model.geom('geom1').run('boxsel2');
model.geom('geom1').feature.duplicate('boxsel3', 'boxsel2');
model.geom('geom1').feature('boxsel3').label('O2 Side Domains');
model.geom('geom1').feature('boxsel3').set('zmin', 'H_mem/4');
model.geom('geom1').feature('boxsel3').set('zmax', Inf);
model.geom('geom1').run('boxsel3');
model.geom('geom1').create('intsel1', 'IntersectionSelection');
model.geom('geom1').feature('intsel1').label('H2 GDL');
model.geom('geom1').feature('intsel1').set('input', {'blk1' 'boxsel2'});
model.geom('geom1').run('intsel1');
model.geom('geom1').create('intsel2', 'IntersectionSelection');
model.geom('geom1').feature('intsel2').label('O2 GDL');
model.geom('geom1').feature('intsel2').set('input', {'blk1' 'boxsel3'});
model.geom('geom1').run('intsel2');
model.geom('geom1').create('intsel3', 'IntersectionSelection');
model.geom('geom1').feature('intsel3').label('H2 Channels');
model.geom('geom1').feature('intsel3').set('input', {'ext1' 'boxsel2'});
model.geom('geom1').run('intsel3');
model.geom('geom1').create('intsel4', 'IntersectionSelection');
model.geom('geom1').feature('intsel4').label('O2 Channels');
model.geom('geom1').feature('intsel4').set('input', {'ext1' 'boxsel3'});
model.geom('geom1').run('intsel4');
model.geom('geom1').create('boxsel4', 'BoxSelection');
model.geom('geom1').feature('boxsel4').label('H2 Inlets');
model.geom('geom1').feature('boxsel4').set('entitydim', 2);
model.geom('geom1').feature('boxsel4').set('xmin', 'if(FLOW_DIRECTION==0, -Inf, L_plate-L_repeat/2-W_ch/10)');
model.geom('geom1').feature('boxsel4').set('xmax', 'if(FLOW_DIRECTION==0, -L_repeat/2+W_ch/10, Inf)');
model.geom('geom1').feature('boxsel4').set('zmax', '-H_mem/2-H_gdl/2');
model.geom('geom1').feature('boxsel4').set('condition', 'inside');
model.geom('geom1').run('boxsel4');
model.geom('geom1').create('boxsel5', 'BoxSelection');
model.geom('geom1').feature('boxsel5').label('O2 Inlets');
model.geom('geom1').feature('boxsel5').set('entitydim', 2);
model.geom('geom1').feature('boxsel5').set('xmax', '-L_repeat/2+W_ch/10');
model.geom('geom1').feature('boxsel5').set('zmin', 'H_mem/2+H_gdl/2');
model.geom('geom1').feature('boxsel5').set('condition', 'inside');
model.geom('geom1').run('boxsel5');
model.geom('geom1').create('boxsel6', 'BoxSelection');
model.geom('geom1').feature('boxsel6').label('H2 Outlets');
model.geom('geom1').feature('boxsel6').set('entitydim', 2);
model.geom('geom1').feature('boxsel6').set('xmin', 'if(FLOW_DIRECTION==1, -Inf, L_plate-L_repeat/2-W_ch/10)');
model.geom('geom1').feature('boxsel6').set('xmax', 'if(FLOW_DIRECTION==1, -L_repeat/2+W_ch/10, Inf)');
model.geom('geom1').feature('boxsel6').set('zmax', '-H_mem/2-H_gdl/2');
model.geom('geom1').feature('boxsel6').set('condition', 'inside');
model.geom('geom1').run('boxsel6');
model.geom('geom1').create('boxsel7', 'BoxSelection');
model.geom('geom1').feature('boxsel7').label('O2 Outlets');
model.geom('geom1').feature('boxsel7').set('entitydim', 2);
model.geom('geom1').feature('boxsel7').set('xmin', 'L_plate-L_repeat/2-W_ch/10');
model.geom('geom1').feature('boxsel7').set('zmin', 'H_mem/2+H_gdl/2');
model.geom('geom1').feature('boxsel7').set('condition', 'inside');
model.geom('geom1').run('boxsel7');
model.geom('geom1').create('boxsel8', 'BoxSelection');
model.geom('geom1').feature('boxsel8').label('H2 GDE');
model.geom('geom1').feature('boxsel8').set('entitydim', 2);
model.geom('geom1').feature('boxsel8').set('zmin', '-H_mem/2-H_gdl/2');
model.geom('geom1').feature('boxsel8').set('zmax', '-H_mem/4');
model.geom('geom1').feature('boxsel8').set('condition', 'inside');
model.geom('geom1').run('boxsel8');
model.geom('geom1').create('boxsel9', 'BoxSelection');
model.geom('geom1').feature('boxsel9').label('O2 GDE');
model.geom('geom1').feature('boxsel9').set('entitydim', 2);
model.geom('geom1').feature('boxsel9').set('zmin', 'H_mem/4');
model.geom('geom1').feature('boxsel9').set('zmax', 'H_mem/2+H_gdl/2');
model.geom('geom1').feature('boxsel9').set('condition', 'inside');
model.geom('geom1').run('boxsel9');
model.geom('geom1').create('boxsel10', 'BoxSelection');
model.geom('geom1').feature('boxsel10').label('H2 Lower GDL Boundary');
model.geom('geom1').feature('boxsel10').set('entitydim', 2);
model.geom('geom1').feature('boxsel10').set('zmin', '-H_gdl*3/2-H_mem');
model.geom('geom1').feature('boxsel10').set('zmax', '-H_gdl/2-H_mem/2');
model.geom('geom1').feature('boxsel10').set('zmin', '-H_gdl*3/2-H_mem/2');
model.geom('geom1').feature('boxsel10').set('condition', 'inside');
model.geom('geom1').feature('boxsel10').set('selshow', false);
model.geom('geom1').run('boxsel10');
model.geom('geom1').create('boxsel11', 'BoxSelection');
model.geom('geom1').feature('boxsel11').label('O2 Upper GDL Boundary');
model.geom('geom1').feature('boxsel11').set('entitydim', 2);
model.geom('geom1').feature('boxsel11').set('zmin', 'H_gdl/2+H_mem/2');
model.geom('geom1').feature('boxsel11').set('zmax', 'H_gdl*3/2+H_mem/2');
model.geom('geom1').feature('boxsel11').set('condition', 'inside');
model.geom('geom1').feature('boxsel11').set('selshow', false);
model.geom('geom1').run('boxsel11');
model.geom('geom1').create('difsel1', 'DifferenceSelection');
model.geom('geom1').feature('difsel1').label('H2 Current Collector');
model.geom('geom1').feature('difsel1').set('entitydim', 2);
model.geom('geom1').feature('difsel1').set('add', {'boxsel10'});
model.geom('geom1').feature('difsel1').set('subtract', {'ext1'});
model.geom('geom1').run('difsel1');
model.geom('geom1').create('difsel2', 'DifferenceSelection');
model.geom('geom1').feature('difsel2').label('O2 Current Collector');
model.geom('geom1').feature('difsel2').set('entitydim', 2);
model.geom('geom1').feature('difsel2').set('add', {'boxsel11'});
model.geom('geom1').feature('difsel2').set('subtract', {'ext1'});
model.geom('geom1').run('difsel2');
model.geom('geom1').create('boxsel12', 'BoxSelection');
model.geom('geom1').feature('boxsel12').label('Channel Sweep Mesh Domains');
model.geom('geom1').feature('boxsel12').set('ymin', 'N_ch*W_ribch+W_ch/4');
model.geom('geom1').feature('boxsel12').set('ymax', 'W_plate-N_ch*W_ribch-W_ch/4');
model.geom('geom1').feature('boxsel12').set('condition', 'inside');
model.geom('geom1').run('boxsel12');
model.geom('geom1').create('difsel3', 'DifferenceSelection');
model.geom('geom1').feature('difsel3').label('Channel Tet Mesh Domains');
model.geom('geom1').feature('difsel3').set('add', {'ext1'});
model.geom('geom1').feature('difsel3').set('subtract', {'boxsel12'});
model.geom('geom1').run('difsel3');
model.geom('geom1').create('adjsel1', 'AdjacentSelection');
model.geom('geom1').feature('adjsel1').label('Channel Sweep Mesh Boundaries');
model.geom('geom1').feature('adjsel1').set('input', {'boxsel12'});
model.geom('geom1').run('adjsel1');
model.geom('geom1').create('adjsel2', 'AdjacentSelection');
model.geom('geom1').feature('adjsel2').label('Channel Tet Mesh Boundaries');
model.geom('geom1').feature('adjsel2').set('input', {'difsel3'});
model.geom('geom1').run('adjsel2');
model.geom('geom1').create('intsel5', 'IntersectionSelection');
model.geom('geom1').feature('intsel5').label('Channel Mesh Sweep Faces');
model.geom('geom1').feature('intsel5').set('entitydim', 2);
model.geom('geom1').feature('intsel5').set('input', {'adjsel1' 'adjsel2'});
model.geom('geom1').feature.duplicate('boxsel13', 'boxsel10');
model.geom('geom1').feature('boxsel13').label('H2 Lower GDL Boundary Mesh Sweep Area');
model.geom('geom1').feature('boxsel13').set('ymin', 'N_ch*W_ribch-W_ch/10');
model.geom('geom1').feature('boxsel13').set('ymax', 'W_plate-N_ch*W_ribch+W_ch/10');
model.geom('geom1').feature.duplicate('boxsel14', 'boxsel11');
model.geom('geom1').feature('boxsel14').label('O2 Upper GDL Boundary Mesh Sweep Area');
model.geom('geom1').feature('boxsel14').set('ymin', 'N_ch*W_ribch-W_ch/10');
model.geom('geom1').feature('boxsel14').set('ymax', 'W_plate-N_ch*W_ribch+W_ch/10');
model.geom('geom1').run('boxsel14');
model.geom('geom1').create('intsel6', 'IntersectionSelection');
model.geom('geom1').feature('intsel6').label('Lower Current Collector Mapped Mesh Boundaries');
model.geom('geom1').feature('intsel6').set('entitydim', 2);
model.geom('geom1').feature('intsel6').set('input', {'difsel1' 'boxsel13'});
model.geom('geom1').feature('intsel6').set('selshow', false);
model.geom('geom1').run('intsel6');
model.geom('geom1').create('intsel7', 'IntersectionSelection');
model.geom('geom1').feature('intsel7').label('Upper Current Collector Mapped Mesh Boundaries');
model.geom('geom1').feature('intsel7').set('entitydim', 2);
model.geom('geom1').feature('intsel7').set('input', {'difsel2' 'boxsel14'});
model.geom('geom1').feature('intsel7').set('selshow', false);
model.geom('geom1').run('intsel7');
model.geom('geom1').create('unisel1', 'UnionSelection');
model.geom('geom1').feature('unisel1').label('Mapped Mesh Current Collector Boundaries');
model.geom('geom1').feature('unisel1').set('entitydim', 2);
model.geom('geom1').feature('unisel1').set('input', {'intsel6' 'intsel7'});
model.geom('geom1').run('unisel1');
model.geom('geom1').create('difsel4', 'DifferenceSelection');
model.geom('geom1').feature('difsel4').label('Triangular Mesh Current Collector Boundaries');
model.geom('geom1').feature('difsel4').set('entitydim', 2);
model.geom('geom1').feature('difsel4').set('add', {'difsel1' 'difsel2'});
model.geom('geom1').feature('difsel4').set('subtract', {'unisel1'});
model.geom('geom1').run('difsel4');
model.geom('geom1').create('unisel2', 'UnionSelection');
model.geom('geom1').feature('unisel2').label('Current Collectors');
model.geom('geom1').feature('unisel2').set('entitydim', 2);
model.geom('geom1').feature('unisel2').set('input', {'difsel1' 'difsel2'});

model.title([]);

model.description('');

model.label('pemfc_serpentine_flow_field_geom_sequence.mph');

model.modelNode.label('Components');

out = model;
